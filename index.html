<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
</head>
<body class="bg-dark">
    <div id="LoginView" class="d-flex justify-content-center align-items-center vh-100">
        <div class="card col-12 col-md-5">
            <div class="card-body">
                <h2 class="text-center">Med-Access Login</h2>

                <form>
                    <label class="form-label" for="txtUsrName">Username</label>
                    <input class="form-control" id="txtUsrName" type="text">
                    <p></p>
                    <label class="form-label" for="txtPassword">Password</label>
                    <input class="form-control" id="txtPassword" type="password">
                    <p></p>
                    <button id="btnLogin" class="btn btn-primary col-12 mt-2" type="button" onclick="login()">Login</button>
                </form>
            </div>
        </div>
    </div>

    <div id="DashboardView" class="d-none">
        <nav class="navbar navbar-expand-lg bg-primary" data-bs-theme="dark">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">Med-Access Dashboard</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarColor01" aria-controls="navbarColor01" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarColor01">
                    <ul class="navbar-nav me-auto">
                        <li class="nav-item">
                            <a class="nav-link active" href="#">
                                Home
                                <span class="visually-hidden">(current)</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">Calls</a>
                        </li>
                        <li class="nav=item">
                            <a class="nav-link">Units Available</a>
                        </li>
                    </ul>
                    <button id="btnLogout" class="btn btn-primary" type="button" onclick="logout()">Logout</button>
                </div>
            </div>
        </nav>

        <table class="table table-bordered mt-4">
            <thead id="tableHead"></thead>
            <tbody id="tableBody"></tbody>
        </table>

        <p>You have successfully logged in!</p>
    </div>

    <script>
        async function login() {
            const usr = document.getElementById('txtUsrName').value
            const pass = document.getElementById('txtPassword').value

            if (!usr || !pass) {
                alert("Please enter username and password");
                return;
            }

            if (usr == "testing" && pass == "testing123!") {
                showDashboard();
            } else {
                alert('Invalid Login Attempt')
            }

            /* try {
                const fetchRes = await fetch("http://localhost:8000/login", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify ({
                        username: usr,
                        password: pass
                    })
                });

                const data = await fetchRes.json();

                if (!fetchRes.ok || !data.success) {
                    alert(data.message || "Invalid login");
                    return;
                }

                // Backend decides admin vs user
                if (data.isAdmin) {
                    window.location.href = "admin.html";
                } else {
                    showDashboard();
                }
            } catch (err) {
                console.error("Login error:", err);
                alert("Server error. Please try again later.");
            } */
        }

        function showDashboard() {
            document.getElementById("LoginView").classList.add("d-none");
            document.getElementById("DashboardView").classList.remove("d-none");

            loadTestData();
        }

        function logout() {
            document.getElementById("DashboardView").classList.add("d-none");
            document.getElementById("LoginView").classList.remove("d-none");

            document.getElementById("txtUsrName").value = '';
            document.getElementById("txtPassword").value = '';
        }

        async function loadTestData() {
            try {
                const fetchRes = await fetch("http://localhost:8000/test");
                const data = await fetchRes.json();

                const results = data.results;

                const tableHead = document.getElementById("tableHead");
                const tableBody = document.getElementById("tableBody");

                tableHead.innerHTML = "";
                tableBody.innerHTML = "";

                if (results.length === 0) {
                    tableBody.innerHTML = "<tr><td>No data found</td></tr>";
                    return;
                }

                // Build table headers
                const headers = Object.keys(results[0]);
                let headRow = "<tr>";
                headers.forEach(h => headRow += `<th>${h}</th>`);
                headRow += "</tr>";
                tableHead.innerHTML = headRow;

                // Build table rows
                results.forEach(row => {
                    let rowHTML = "<tr>";
                    headers.forEach(h => rowHTML += `<td>${row[h]}</td>`);
                    rowHTML += "</tr>";
                    tableBody.innerHTML += rowHTML;
                });
            } catch (err) {
                console.error("Error loading data:", err);
            }
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
</body>